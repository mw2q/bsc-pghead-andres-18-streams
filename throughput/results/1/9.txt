BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%rose%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 267712877.482352
 ALGERIA                   |   1997 | 448314973.458503
 ALGERIA                   |   1996 | 463482901.132003
 ALGERIA                   |   1995 | 450965100.340344
 ALGERIA                   |   1994 | 457275157.290572
 ALGERIA                   |   1993 | 460207566.116394
 ALGERIA                   |   1992 | 466504445.464163
 ARGENTINA                 |   1998 | 272725293.404322
 ARGENTINA                 |   1997 |  463492864.35762
 ARGENTINA                 |   1996 | 460732801.390675
 ARGENTINA                 |   1995 | 460839155.398396
 ARGENTINA                 |   1994 | 469545032.265662
 ARGENTINA                 |   1993 | 464486503.631211
 ARGENTINA                 |   1992 | 456554795.293564
 BRAZIL                    |   1998 |  272894488.66137
 BRAZIL                    |   1997 | 457801418.776654
 BRAZIL                    |   1996 | 463529433.181465
 BRAZIL                    |   1995 | 456060589.767716
 BRAZIL                    |   1994 | 462475206.244909
 BRAZIL                    |   1993 | 464357573.079174
 BRAZIL                    |   1992 | 461174858.457694
 CANADA                    |   1998 | 275233883.660528
 CANADA                    |   1997 | 469922053.032658
 CANADA                    |   1996 | 471947721.777243
 CANADA                    |   1995 | 474775608.487145
 CANADA                    |   1994 | 472353536.004951
 CANADA                    |   1993 | 474935298.007254
 CANADA                    |   1992 | 478042655.369772
 CHINA                     |   1998 | 272144464.618848
 CHINA                     |   1997 | 462221674.992504
 CHINA                     |   1996 | 455611050.069019
 CHINA                     |   1995 | 467301680.353423
 CHINA                     |   1994 | 464837043.512568
 CHINA                     |   1993 | 459524029.057467
 CHINA                     |   1992 | 467712871.303081
 EGYPT                     |   1998 | 272485193.953211
 EGYPT                     |   1997 | 461983232.244092
 EGYPT                     |   1996 |  470317209.20537
 EGYPT                     |   1995 | 457901499.781604
 EGYPT                     |   1994 | 464181210.574778
 EGYPT                     |   1993 | 465487234.867489
 EGYPT                     |   1992 | 458454490.840393
 ETHIOPIA                  |   1998 | 269249298.754039
 ETHIOPIA                  |   1997 | 456593596.583759
 ETHIOPIA                  |   1996 | 451881941.893064
 ETHIOPIA                  |   1995 | 450752961.810228
 ETHIOPIA                  |   1994 | 464044915.380122
 ETHIOPIA                  |   1993 | 453922375.996362
 ETHIOPIA                  |   1992 | 458993497.807445
 FRANCE                    |   1998 | 267596571.146736
 FRANCE                    |   1997 | 456945035.778785
 FRANCE                    |   1996 | 461034515.076388
 FRANCE                    |   1995 | 453249382.300642
 FRANCE                    |   1994 |  463810539.34522
 FRANCE                    |   1993 | 465539971.761772
 FRANCE                    |   1992 | 457370508.357447
 GERMANY                   |   1998 | 281204558.086984
 GERMANY                   |   1997 | 475830882.656514
 GERMANY                   |   1996 |  483507247.09859
 GERMANY                   |   1995 | 475675828.868428
 GERMANY                   |   1994 | 476162043.581738
 GERMANY                   |   1993 | 482077737.905759
 GERMANY                   |   1992 | 477384497.701221
 INDIA                     |   1998 | 279197716.051501
 INDIA                     |   1997 | 476991958.495977
 INDIA                     |   1996 | 477082420.493289
 INDIA                     |   1995 | 479315262.737374
 INDIA                     |   1994 | 478008062.987662
 INDIA                     |   1993 | 479844149.649283
 INDIA                     |   1992 | 478092139.952205
 INDONESIA                 |   1998 | 272050105.501713
 INDONESIA                 |   1997 | 456765231.868982
 INDONESIA                 |   1996 | 455699413.684586
 INDONESIA                 |   1995 | 452991568.856836
 INDONESIA                 |   1994 | 460373534.148317
 INDONESIA                 |   1993 | 457096019.045542
 INDONESIA                 |   1992 |  460042154.84903
 IRAN                      |   1998 | 269397652.656714
 IRAN                      |   1997 | 468190474.481412
 IRAN                      |   1996 | 461822337.621455
 IRAN                      |   1995 |  466031877.04339
 IRAN                      |   1994 | 464467424.853114
 IRAN                      |   1993 | 458472759.444045
 IRAN                      |   1992 | 468524699.973288
 IRAQ                      |   1998 | 281545583.450175
 IRAQ                      |   1997 |  468273448.05146
 IRAQ                      |   1996 | 476185790.993799
 IRAQ                      |   1995 |   477888036.0343
 IRAQ                      |   1994 | 473221892.078161
 IRAQ                      |   1993 | 469846605.579191
 IRAQ                      |   1992 | 473129992.486924
 JAPAN                     |   1998 | 265439625.674002
 JAPAN                     |   1997 |  468503888.10468
 JAPAN                     |   1996 | 464436883.815145
 JAPAN                     |   1995 | 466557317.710156
 JAPAN                     |   1994 |  466281462.06814
 JAPAN                     |   1993 | 463495559.262517
 JAPAN                     |   1992 | 468652750.400091
 JORDAN                    |   1998 | 275393418.177881
 JORDAN                    |   1997 |  463086785.86035
 JORDAN                    |   1996 | 463728651.817283
 JORDAN                    |   1995 | 464877647.733833
 JORDAN                    |   1994 | 469398596.762584
 JORDAN                    |   1993 | 458216759.319562
 JORDAN                    |   1992 |  458578027.97088
 KENYA                     |   1998 | 274512233.215651
 KENYA                     |   1997 | 463366047.767445
 KENYA                     |   1996 | 468304885.546929
 KENYA                     |   1995 | 462968395.108301
 KENYA                     |   1994 | 462942982.133674
 KENYA                     |   1993 | 466268401.064974
 KENYA                     |   1992 | 461865654.377847
 MOROCCO                   |   1998 | 269081367.711318
 MOROCCO                   |   1997 | 465259712.083326
 MOROCCO                   |   1996 | 468095143.557842
 MOROCCO                   |   1995 | 468227472.892679
 MOROCCO                   |   1994 | 472663509.657989
 MOROCCO                   |   1993 | 475536737.432051
 MOROCCO                   |   1992 | 468012020.540002
 MOZAMBIQUE                |   1998 | 271772180.448305
 MOZAMBIQUE                |   1997 | 461242068.669255
 MOZAMBIQUE                |   1996 | 458082658.401907
 MOZAMBIQUE                |   1995 | 459223225.626537
 MOZAMBIQUE                |   1994 | 466680766.752316
 MOZAMBIQUE                |   1993 |  459244399.42669
 MOZAMBIQUE                |   1992 | 460507711.215167
 PERU                      |   1998 | 276268361.323676
 PERU                      |   1997 |  458498554.63826
 PERU                      |   1996 | 462626441.275987
 PERU                      |   1995 | 459812917.388241
 PERU                      |   1994 | 461519462.795691
 PERU                      |   1993 | 460148737.024647
 PERU                      |   1992 | 466760098.843157
 ROMANIA                   |   1998 | 275008246.199676
 ROMANIA                   |   1997 | 462998728.032578
 ROMANIA                   |   1996 | 473068952.343951
 ROMANIA                   |   1995 |   469503193.0323
 ROMANIA                   |   1994 | 466966728.773246
 ROMANIA                   |   1993 | 470388394.086247
 ROMANIA                   |   1992 | 472443782.896622
 RUSSIA                    |   1998 | 274657604.621695
 RUSSIA                    |   1997 | 469998981.380971
 RUSSIA                    |   1996 | 474471488.779673
 RUSSIA                    |   1995 | 465378708.979319
 RUSSIA                    |   1994 | 462272461.459003
 RUSSIA                    |   1993 | 457413281.648173
 RUSSIA                    |   1992 | 470226382.546974
 SAUDI ARABIA              |   1998 | 284302363.117708
 SAUDI ARABIA              |   1997 | 475483257.862671
 SAUDI ARABIA              |   1996 | 469795018.240841
 SAUDI ARABIA              |   1995 |  482941538.08027
 SAUDI ARABIA              |   1994 | 475461798.510047
 SAUDI ARABIA              |   1993 | 474044011.248262
 SAUDI ARABIA              |   1992 | 473950282.761085
 UNITED KINGDOM            |   1998 | 269134677.311492
 UNITED KINGDOM            |   1997 | 451898183.897831
 UNITED KINGDOM            |   1996 |  449983609.71165
 UNITED KINGDOM            |   1995 | 449812408.945946
 UNITED KINGDOM            |   1994 | 454226642.009043
 UNITED KINGDOM            |   1993 | 447640991.537687
 UNITED KINGDOM            |   1992 | 450456582.509662
 UNITED STATES             |   1998 | 270087741.631664
 UNITED STATES             |   1997 | 463347468.855295
 UNITED STATES             |   1996 | 462363357.046453
 UNITED STATES             |   1995 | 458356117.460647
 UNITED STATES             |   1994 | 463543898.575489
 UNITED STATES             |   1993 | 469003866.585001
 UNITED STATES             |   1992 | 468200591.855354
 VIETNAM                   |   1998 | 275925409.070825
 VIETNAM                   |   1997 | 463258027.809048
 VIETNAM                   |   1996 | 464482386.369508
 VIETNAM                   |   1995 | 462502293.600079
 VIETNAM                   |   1994 | 463551133.945202
 VIETNAM                   |   1993 | 464522239.859406
 VIETNAM                   |   1992 | 463015762.468614
(175 rows)

COMMIT;
COMMIT
