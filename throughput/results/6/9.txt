BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%lace%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 264058519.771605
 ALGERIA                   |   1997 | 451122556.215721
 ALGERIA                   |   1996 | 451404867.277943
 ALGERIA                   |   1995 | 453859651.587559
 ALGERIA                   |   1994 | 458333685.863208
 ALGERIA                   |   1993 | 454422631.013169
 ALGERIA                   |   1992 | 450254198.334386
 ARGENTINA                 |   1998 | 268162705.788832
 ARGENTINA                 |   1997 | 460666757.442729
 ARGENTINA                 |   1996 | 461345539.800373
 ARGENTINA                 |   1995 | 455356251.888483
 ARGENTINA                 |   1994 | 460230782.875022
 ARGENTINA                 |   1993 | 462209033.278686
 ARGENTINA                 |   1992 | 460390723.293848
 BRAZIL                    |   1998 | 276931454.227668
 BRAZIL                    |   1997 | 472717040.379728
 BRAZIL                    |   1996 | 476338882.104405
 BRAZIL                    |   1995 | 482154611.156527
 BRAZIL                    |   1994 | 475682775.662331
 BRAZIL                    |   1993 |  472895984.75879
 BRAZIL                    |   1992 | 471944276.631922
 CANADA                    |   1998 | 280154941.170966
 CANADA                    |   1997 | 476054755.130501
 CANADA                    |   1996 | 481016615.147454
 CANADA                    |   1995 | 469820995.347709
 CANADA                    |   1994 | 471716594.689099
 CANADA                    |   1993 | 476127614.924388
 CANADA                    |   1992 | 476196623.022612
 CHINA                     |   1998 | 272312772.135872
 CHINA                     |   1997 | 463203063.882851
 CHINA                     |   1996 | 462255479.085698
 CHINA                     |   1995 | 457445297.742312
 CHINA                     |   1994 | 464329079.437523
 CHINA                     |   1993 | 463116339.263465
 CHINA                     |   1992 | 459010554.533754
 EGYPT                     |   1998 | 275342795.741772
 EGYPT                     |   1997 | 463772456.476034
 EGYPT                     |   1996 | 461618016.421316
 EGYPT                     |   1995 | 462590675.892796
 EGYPT                     |   1994 | 462208982.519275
 EGYPT                     |   1993 |  468590163.61633
 EGYPT                     |   1992 | 468829047.327817
 ETHIOPIA                  |   1998 | 272111236.972477
 ETHIOPIA                  |   1997 | 466312374.872862
 ETHIOPIA                  |   1996 | 463348095.811152
 ETHIOPIA                  |   1995 | 467913074.028696
 ETHIOPIA                  |   1994 | 472069446.311025
 ETHIOPIA                  |   1993 | 469223079.818656
 ETHIOPIA                  |   1992 | 462903989.654072
 FRANCE                    |   1998 | 262450525.148583
 FRANCE                    |   1997 | 453827896.781873
 FRANCE                    |   1996 | 454863128.132645
 FRANCE                    |   1995 |  462326459.62265
 FRANCE                    |   1994 | 458326098.913321
 FRANCE                    |   1993 | 456061942.854191
 FRANCE                    |   1992 | 453020735.610368
 GERMANY                   |   1998 | 274922216.184947
 GERMANY                   |   1997 | 465725179.878761
 GERMANY                   |   1996 | 466652735.609716
 GERMANY                   |   1995 | 474739006.665821
 GERMANY                   |   1994 |  472306454.68013
 GERMANY                   |   1993 | 473409334.718037
 GERMANY                   |   1992 | 467734965.018216
 INDIA                     |   1998 | 285139940.674468
 INDIA                     |   1997 | 474995680.214167
 INDIA                     |   1996 | 482842148.326472
 INDIA                     |   1995 | 479046907.006671
 INDIA                     |   1994 | 474484756.800651
 INDIA                     |   1993 | 481269334.857847
 INDIA                     |   1992 | 477947720.505754
 INDONESIA                 |   1998 | 270643197.593562
 INDONESIA                 |   1997 | 472881084.893856
 INDONESIA                 |   1996 | 467357880.010832
 INDONESIA                 |   1995 | 463925571.494714
 INDONESIA                 |   1994 | 473727447.637925
 INDONESIA                 |   1993 | 467093195.589831
 INDONESIA                 |   1992 | 467317375.279367
 IRAN                      |   1998 | 269864330.771119
 IRAN                      |   1997 | 467024678.830345
 IRAN                      |   1996 | 459822777.643702
 IRAN                      |   1995 | 465165754.542061
 IRAN                      |   1994 |  457721237.03208
 IRAN                      |   1993 | 462419362.293609
 IRAN                      |   1992 | 467222225.361181
 IRAQ                      |   1998 | 272518514.048743
 IRAQ                      |   1997 | 470015271.777556
 IRAQ                      |   1996 | 467133753.176469
 IRAQ                      |   1995 | 468791347.053054
 IRAQ                      |   1994 | 478009119.055066
 IRAQ                      |   1993 | 462499202.149734
 IRAQ                      |   1992 | 466388049.684558
 JAPAN                     |   1998 | 275436500.833211
 JAPAN                     |   1997 | 465697015.181646
 JAPAN                     |   1996 | 466886730.670552
 JAPAN                     |   1995 | 473953790.444998
 JAPAN                     |   1994 | 458220381.043563
 JAPAN                     |   1993 | 469797695.453532
 JAPAN                     |   1992 | 473082009.461486
 JORDAN                    |   1998 | 269967808.690756
 JORDAN                    |   1997 | 460146534.378732
 JORDAN                    |   1996 | 463389574.610536
 JORDAN                    |   1995 | 462207740.615323
 JORDAN                    |   1994 | 465673884.631319
 JORDAN                    |   1993 | 466803375.095677
 JORDAN                    |   1992 |   463511070.5077
 KENYA                     |   1998 | 278448823.358829
 KENYA                     |   1997 | 474211057.228604
 KENYA                     |   1996 | 470180480.284015
 KENYA                     |   1995 | 468297054.589563
 KENYA                     |   1994 | 473594177.350967
 KENYA                     |   1993 |  473651331.91851
 KENYA                     |   1992 | 485185422.770464
 MOROCCO                   |   1998 |  272686891.42671
 MOROCCO                   |   1997 | 476791789.541914
 MOROCCO                   |   1996 | 467174348.110203
 MOROCCO                   |   1995 | 461967969.276955
 MOROCCO                   |   1994 |  467844626.01711
 MOROCCO                   |   1993 | 468639789.614962
 MOROCCO                   |   1992 | 464951922.833037
 MOZAMBIQUE                |   1998 | 267692262.769795
 MOZAMBIQUE                |   1997 | 460415105.873375
 MOZAMBIQUE                |   1996 | 464901164.290984
 MOZAMBIQUE                |   1995 | 454254557.755561
 MOZAMBIQUE                |   1994 | 457790810.067005
 MOZAMBIQUE                |   1993 | 455684358.957771
 MOZAMBIQUE                |   1992 | 450123460.191921
 PERU                      |   1998 | 269912750.460165
 PERU                      |   1997 | 459400301.825383
 PERU                      |   1996 | 469377027.058723
 PERU                      |   1995 | 463522900.123541
 PERU                      |   1994 | 459714747.004404
 PERU                      |   1993 | 467929310.198365
 PERU                      |   1992 | 465275846.221033
 ROMANIA                   |   1998 | 271934766.950739
 ROMANIA                   |   1997 | 463751563.749829
 ROMANIA                   |   1996 | 472914572.661754
 ROMANIA                   |   1995 | 467574180.742391
 ROMANIA                   |   1994 |  473903975.17495
 ROMANIA                   |   1993 | 474853168.514268
 ROMANIA                   |   1992 |  469656271.10587
 RUSSIA                    |   1998 | 275895943.487981
 RUSSIA                    |   1997 | 471666573.650606
 RUSSIA                    |   1996 |  473827634.93961
 RUSSIA                    |   1995 |  462814807.91374
 RUSSIA                    |   1994 |  470312322.32438
 RUSSIA                    |   1993 | 463739489.572797
 RUSSIA                    |   1992 | 474513896.063539
 SAUDI ARABIA              |   1998 | 272912227.989503
 SAUDI ARABIA              |   1997 | 468176981.601947
 SAUDI ARABIA              |   1996 | 466963555.069808
 SAUDI ARABIA              |   1995 | 468597676.887476
 SAUDI ARABIA              |   1994 | 466488599.559316
 SAUDI ARABIA              |   1993 | 468394952.543351
 SAUDI ARABIA              |   1992 | 469389860.142969
 UNITED KINGDOM            |   1998 | 277647048.620428
 UNITED KINGDOM            |   1997 | 465242035.916845
 UNITED KINGDOM            |   1996 | 465080780.556495
 UNITED KINGDOM            |   1995 | 464793833.311204
 UNITED KINGDOM            |   1994 | 472495468.564814
 UNITED KINGDOM            |   1993 | 461075269.790676
 UNITED KINGDOM            |   1992 | 454265027.593506
 UNITED STATES             |   1998 | 262893755.891873
 UNITED STATES             |   1997 | 460229358.971571
 UNITED STATES             |   1996 | 465069607.896036
 UNITED STATES             |   1995 | 458352523.386456
 UNITED STATES             |   1994 | 458642584.511985
 UNITED STATES             |   1993 |  463700501.90859
 UNITED STATES             |   1992 |  454598146.19599
 VIETNAM                   |   1998 | 271264038.227662
 VIETNAM                   |   1997 |  465170047.38548
 VIETNAM                   |   1996 | 477959277.453699
 VIETNAM                   |   1995 | 470091155.311851
 VIETNAM                   |   1994 |  464702964.94044
 VIETNAM                   |   1993 | 467356983.183037
 VIETNAM                   |   1992 | 471133843.558825
(175 rows)

COMMIT;
COMMIT
