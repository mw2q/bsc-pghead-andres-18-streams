BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%royal%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 260842218.591019
 ALGERIA                   |   1997 | 459046794.380837
 ALGERIA                   |   1996 | 463389797.538836
 ALGERIA                   |   1995 | 452849682.874662
 ALGERIA                   |   1994 | 452966796.307709
 ALGERIA                   |   1993 | 460304452.934655
 ALGERIA                   |   1992 | 461761889.271392
 ARGENTINA                 |   1998 | 288073620.743292
 ARGENTINA                 |   1997 | 483081334.540119
 ARGENTINA                 |   1996 | 490243502.372345
 ARGENTINA                 |   1995 | 483888550.569525
 ARGENTINA                 |   1994 | 487815669.480994
 ARGENTINA                 |   1993 |  476507442.30253
 ARGENTINA                 |   1992 | 480328310.711502
 BRAZIL                    |   1998 | 276331549.592608
 BRAZIL                    |   1997 | 470831514.085038
 BRAZIL                    |   1996 |  471759863.89883
 BRAZIL                    |   1995 | 470347123.080507
 BRAZIL                    |   1994 | 463139428.599952
 BRAZIL                    |   1993 | 476615271.042092
 BRAZIL                    |   1992 |   470469133.3497
 CANADA                    |   1998 | 275820189.502209
 CANADA                    |   1997 |  475058509.33256
 CANADA                    |   1996 | 473209900.957112
 CANADA                    |   1995 | 472577536.847187
 CANADA                    |   1994 | 477079224.955172
 CANADA                    |   1993 | 472080175.226368
 CANADA                    |   1992 | 469726916.279668
 CHINA                     |   1998 | 269639558.404532
 CHINA                     |   1997 | 464892470.194141
 CHINA                     |   1996 | 467097940.703439
 CHINA                     |   1995 | 467174101.569456
 CHINA                     |   1994 | 468020898.922507
 CHINA                     |   1993 | 471182619.431659
 CHINA                     |   1992 | 466042114.611078
 EGYPT                     |   1998 | 270697195.246057
 EGYPT                     |   1997 | 461152590.912541
 EGYPT                     |   1996 | 462902826.231589
 EGYPT                     |   1995 | 465271608.284689
 EGYPT                     |   1994 | 460901890.225448
 EGYPT                     |   1993 | 460682294.821442
 EGYPT                     |   1992 | 457081817.413368
 ETHIOPIA                  |   1998 | 270174950.336316
 ETHIOPIA                  |   1997 | 462369739.844362
 ETHIOPIA                  |   1996 | 456044060.249885
 ETHIOPIA                  |   1995 | 457978799.917708
 ETHIOPIA                  |   1994 | 457940663.261197
 ETHIOPIA                  |   1993 | 462353016.810546
 ETHIOPIA                  |   1992 | 464135525.948457
 FRANCE                    |   1998 | 276140600.493522
 FRANCE                    |   1997 | 463095842.732656
 FRANCE                    |   1996 |  463334055.12351
 FRANCE                    |   1995 | 460922091.644793
 FRANCE                    |   1994 | 464298478.460655
 FRANCE                    |   1993 |  464981694.82117
 FRANCE                    |   1992 |   462742115.6122
 GERMANY                   |   1998 | 277804400.358477
 GERMANY                   |   1997 | 475622864.031303
 GERMANY                   |   1996 | 481876755.380691
 GERMANY                   |   1995 |  474586546.59163
 GERMANY                   |   1994 | 477738860.794879
 GERMANY                   |   1993 |   482333270.4328
 GERMANY                   |   1992 | 477317671.096886
 INDIA                     |   1998 | 280175294.734799
 INDIA                     |   1997 | 465084995.218459
 INDIA                     |   1996 | 468503058.385701
 INDIA                     |   1995 | 462321248.340742
 INDIA                     |   1994 |  474456220.69923
 INDIA                     |   1993 | 478107687.006314
 INDIA                     |   1992 |  476279129.61942
 INDONESIA                 |   1998 | 275268159.258473
 INDONESIA                 |   1997 | 467995320.059042
 INDONESIA                 |   1996 | 463219931.208623
 INDONESIA                 |   1995 | 467040945.471573
 INDONESIA                 |   1994 | 465488068.053924
 INDONESIA                 |   1993 | 474576992.073356
 INDONESIA                 |   1992 | 459834736.726527
 IRAN                      |   1998 | 268650638.333723
 IRAN                      |   1997 | 456557046.606249
 IRAN                      |   1996 | 456977219.413647
 IRAN                      |   1995 | 463984470.811408
 IRAN                      |   1994 | 459269025.364496
 IRAN                      |   1993 | 457848473.750552
 IRAN                      |   1992 | 462360910.429435
 IRAQ                      |   1998 | 273577842.533894
 IRAQ                      |   1997 | 467088233.998831
 IRAQ                      |   1996 | 475455861.944749
 IRAQ                      |   1995 | 466531572.505751
 IRAQ                      |   1994 | 469507131.561128
 IRAQ                      |   1993 | 470191471.231809
 IRAQ                      |   1992 | 471749081.962577
 JAPAN                     |   1998 | 264684652.171955
 JAPAN                     |   1997 | 457902523.090801
 JAPAN                     |   1996 | 463156826.403234
 JAPAN                     |   1995 | 456880888.694609
 JAPAN                     |   1994 | 469537565.713418
 JAPAN                     |   1993 | 466102192.071382
 JAPAN                     |   1992 | 462861329.036379
 JORDAN                    |   1998 |  273893415.43992
 JORDAN                    |   1997 | 465936441.442803
 JORDAN                    |   1996 | 464477192.481295
 JORDAN                    |   1995 | 458802691.423998
 JORDAN                    |   1994 | 457258031.473872
 JORDAN                    |   1993 | 464509242.131864
 JORDAN                    |   1992 | 459476921.743046
 KENYA                     |   1998 | 279154774.213809
 KENYA                     |   1997 | 472337451.964416
 KENYA                     |   1996 | 471342970.574761
 KENYA                     |   1995 | 474565613.072914
 KENYA                     |   1994 |  468764168.16218
 KENYA                     |   1993 |  471193636.11102
 KENYA                     |   1992 |  471985045.82692
 MOROCCO                   |   1998 | 270090942.969856
 MOROCCO                   |   1997 | 463203791.326391
 MOROCCO                   |   1996 | 470989414.144252
 MOROCCO                   |   1995 | 469533969.993622
 MOROCCO                   |   1994 | 462427327.796422
 MOROCCO                   |   1993 | 465659129.885633
 MOROCCO                   |   1992 |  465552812.15486
 MOZAMBIQUE                |   1998 | 273658741.843851
 MOZAMBIQUE                |   1997 | 470289735.190977
 MOZAMBIQUE                |   1996 | 465421585.439259
 MOZAMBIQUE                |   1995 | 459357355.182414
 MOZAMBIQUE                |   1994 | 470488387.517866
 MOZAMBIQUE                |   1993 | 473285656.005252
 MOZAMBIQUE                |   1992 | 460959262.517094
 PERU                      |   1998 | 279319581.600839
 PERU                      |   1997 | 470462491.151101
 PERU                      |   1996 | 471320741.238669
 PERU                      |   1995 | 466357961.981464
 PERU                      |   1994 | 464220720.484124
 PERU                      |   1993 |  453820721.98305
 PERU                      |   1992 | 463087005.490084
 ROMANIA                   |   1998 | 278052815.046573
 ROMANIA                   |   1997 | 462390104.319362
 ROMANIA                   |   1996 | 476966758.565459
 ROMANIA                   |   1995 |  472144804.87258
 ROMANIA                   |   1994 | 470243409.780061
 ROMANIA                   |   1993 | 474671535.678526
 ROMANIA                   |   1992 |  474784285.88454
 RUSSIA                    |   1998 | 276705605.269225
 RUSSIA                    |   1997 | 467577102.861871
 RUSSIA                    |   1996 |  474809056.22679
 RUSSIA                    |   1995 | 470100953.492037
 RUSSIA                    |   1994 | 474646933.629614
 RUSSIA                    |   1993 | 477093237.274684
 RUSSIA                    |   1992 | 472788017.425131
 SAUDI ARABIA              |   1998 | 274921501.889605
 SAUDI ARABIA              |   1997 | 465284618.887017
 SAUDI ARABIA              |   1996 | 459161068.439851
 SAUDI ARABIA              |   1995 | 464280866.368411
 SAUDI ARABIA              |   1994 | 459308442.217198
 SAUDI ARABIA              |   1993 | 467997764.650507
 SAUDI ARABIA              |   1992 | 459991647.729683
 UNITED KINGDOM            |   1998 | 275319810.990409
 UNITED KINGDOM            |   1997 | 465554387.978481
 UNITED KINGDOM            |   1996 |  466139079.74953
 UNITED KINGDOM            |   1995 | 459994446.137942
 UNITED KINGDOM            |   1994 | 461801818.837395
 UNITED KINGDOM            |   1993 | 469684963.113664
 UNITED KINGDOM            |   1992 |  465751823.80165
 UNITED STATES             |   1998 |  280092331.85802
 UNITED STATES             |   1997 |  477695200.65253
 UNITED STATES             |   1996 | 476945809.921273
 UNITED STATES             |   1995 | 476452076.933769
 UNITED STATES             |   1994 | 482051426.906156
 UNITED STATES             |   1993 | 475019300.748621
 UNITED STATES             |   1992 | 476548922.381183
 VIETNAM                   |   1998 | 273976663.239292
 VIETNAM                   |   1997 | 470140187.037822
 VIETNAM                   |   1996 |  475161809.30523
 VIETNAM                   |   1995 | 462754252.987835
 VIETNAM                   |   1994 | 467713239.633539
 VIETNAM                   |   1993 | 469614086.416144
 VIETNAM                   |   1992 | 474028408.035642
(175 rows)

COMMIT;
COMMIT
