BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%pale%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 |  264969894.92576
 ALGERIA                   |   1997 | 465229539.148312
 ALGERIA                   |   1996 | 467817723.817926
 ALGERIA                   |   1995 | 457584543.128096
 ALGERIA                   |   1994 | 458150935.716047
 ALGERIA                   |   1993 | 462768834.395361
 ALGERIA                   |   1992 | 463514013.008725
 ARGENTINA                 |   1998 | 277418228.936147
 ARGENTINA                 |   1997 | 473419341.089438
 ARGENTINA                 |   1996 |  473021702.76745
 ARGENTINA                 |   1995 | 476377116.889367
 ARGENTINA                 |   1994 | 470846015.832689
 ARGENTINA                 |   1993 | 472277960.934726
 ARGENTINA                 |   1992 | 470429152.223271
 BRAZIL                    |   1998 | 278045643.152102
 BRAZIL                    |   1997 | 478379172.082359
 BRAZIL                    |   1996 | 469175588.525929
 BRAZIL                    |   1995 |  480527555.79864
 BRAZIL                    |   1994 | 478421316.562007
 BRAZIL                    |   1993 | 469923849.732439
 BRAZIL                    |   1992 |  482463834.00505
 CANADA                    |   1998 | 282490269.029417
 CANADA                    |   1997 | 477405862.658643
 CANADA                    |   1996 | 485005622.917326
 CANADA                    |   1995 |  474473755.31928
 CANADA                    |   1994 | 477217704.427271
 CANADA                    |   1993 | 477845893.002143
 CANADA                    |   1992 | 478939262.509339
 CHINA                     |   1998 | 277208928.808405
 CHINA                     |   1997 |  469750128.46894
 CHINA                     |   1996 | 472051810.844459
 CHINA                     |   1995 |  472826841.65724
 CHINA                     |   1994 | 469733973.620327
 CHINA                     |   1993 | 461642699.757214
 CHINA                     |   1992 | 472164076.586826
 EGYPT                     |   1998 | 271574077.501171
 EGYPT                     |   1997 | 466385805.852237
 EGYPT                     |   1996 | 469628396.930158
 EGYPT                     |   1995 | 465347424.951117
 EGYPT                     |   1994 | 467650374.864535
 EGYPT                     |   1993 | 464494758.183582
 EGYPT                     |   1992 | 463451131.511847
 ETHIOPIA                  |   1998 | 267780506.734716
 ETHIOPIA                  |   1997 | 451320686.877155
 ETHIOPIA                  |   1996 | 450374071.797157
 ETHIOPIA                  |   1995 | 445440903.768857
 ETHIOPIA                  |   1994 | 457051948.650426
 ETHIOPIA                  |   1993 |  448544443.76504
 ETHIOPIA                  |   1992 | 455157866.303244
 FRANCE                    |   1998 | 272212339.033794
 FRANCE                    |   1997 | 477565151.516476
 FRANCE                    |   1996 | 468545035.586941
 FRANCE                    |   1995 | 458689391.944242
 FRANCE                    |   1994 | 467879525.709028
 FRANCE                    |   1993 | 467227667.480244
 FRANCE                    |   1992 |  468038379.89153
 GERMANY                   |   1998 | 279855236.684821
 GERMANY                   |   1997 | 477534529.970172
 GERMANY                   |   1996 | 482564707.171351
 GERMANY                   |   1995 | 479316443.573485
 GERMANY                   |   1994 | 474448202.658516
 GERMANY                   |   1993 | 483999400.626506
 GERMANY                   |   1992 | 477766693.882968
 INDIA                     |   1998 |   271443733.7689
 INDIA                     |   1997 | 474980187.032922
 INDIA                     |   1996 | 473085675.797655
 INDIA                     |   1995 | 468593645.555157
 INDIA                     |   1994 | 473089323.062207
 INDIA                     |   1993 |  471346346.57862
 INDIA                     |   1992 | 477457873.284936
 INDONESIA                 |   1998 | 274009861.784699
 INDONESIA                 |   1997 | 469907697.454153
 INDONESIA                 |   1996 | 469974765.871097
 INDONESIA                 |   1995 | 462260014.663914
 INDONESIA                 |   1994 | 459488468.981268
 INDONESIA                 |   1993 | 463473715.846935
 INDONESIA                 |   1992 | 460226795.999835
 IRAN                      |   1998 | 268872794.566542
 IRAN                      |   1997 | 464654162.676877
 IRAN                      |   1996 | 462837428.347265
 IRAN                      |   1995 | 461961290.095845
 IRAN                      |   1994 | 460889147.151637
 IRAN                      |   1993 | 456081135.019198
 IRAN                      |   1992 | 459378055.185869
 IRAQ                      |   1998 | 273459885.432419
 IRAQ                      |   1997 | 469610643.246955
 IRAQ                      |   1996 | 472767425.271821
 IRAQ                      |   1995 | 461530253.957888
 IRAQ                      |   1994 | 478215251.146254
 IRAQ                      |   1993 | 472423448.079002
 IRAQ                      |   1992 | 477798905.084746
 JAPAN                     |   1998 | 274470266.036527
 JAPAN                     |   1997 | 475560772.587538
 JAPAN                     |   1996 | 467569445.739326
 JAPAN                     |   1995 | 473136374.264453
 JAPAN                     |   1994 | 471647411.967427
 JAPAN                     |   1993 | 473625875.061075
 JAPAN                     |   1992 | 479221152.708806
 JORDAN                    |   1998 | 276534537.679835
 JORDAN                    |   1997 | 460475038.838821
 JORDAN                    |   1996 | 459926878.114783
 JORDAN                    |   1995 | 460962568.250955
 JORDAN                    |   1994 | 460491582.357256
 JORDAN                    |   1993 | 466888795.930641
 JORDAN                    |   1992 | 464599590.560588
 KENYA                     |   1998 | 273767866.758066
 KENYA                     |   1997 | 473013182.742036
 KENYA                     |   1996 | 469245964.890841
 KENYA                     |   1995 | 477402256.112189
 KENYA                     |   1994 | 473005535.833691
 KENYA                     |   1993 | 471843565.090285
 KENYA                     |   1992 | 473191412.585525
 MOROCCO                   |   1998 | 277189507.340444
 MOROCCO                   |   1997 | 472733625.143518
 MOROCCO                   |   1996 | 472634169.703391
 MOROCCO                   |   1995 | 464131845.337557
 MOROCCO                   |   1994 | 474707634.304801
 MOROCCO                   |   1993 | 469857526.940778
 MOROCCO                   |   1992 | 474695820.432495
 MOZAMBIQUE                |   1998 | 268525297.922951
 MOZAMBIQUE                |   1997 | 453778301.447164
 MOZAMBIQUE                |   1996 | 458037278.693511
 MOZAMBIQUE                |   1995 | 460399888.506401
 MOZAMBIQUE                |   1994 | 456433812.661774
 MOZAMBIQUE                |   1993 | 460747179.420439
 MOZAMBIQUE                |   1992 | 450740883.619083
 PERU                      |   1998 | 275960868.321049
 PERU                      |   1997 | 468318207.157235
 PERU                      |   1996 | 470073301.448135
 PERU                      |   1995 |  464379744.37097
 PERU                      |   1994 | 468716014.228033
 PERU                      |   1993 | 467741657.168207
 PERU                      |   1992 | 473165714.009318
 ROMANIA                   |   1998 | 273239257.309572
 ROMANIA                   |   1997 | 462978193.963229
 ROMANIA                   |   1996 |  468583262.92489
 ROMANIA                   |   1995 | 469473435.358381
 ROMANIA                   |   1994 |  465400524.08817
 ROMANIA                   |   1993 | 466211605.401145
 ROMANIA                   |   1992 | 467216687.790706
 RUSSIA                    |   1998 | 274680829.338193
 RUSSIA                    |   1997 | 467632849.712744
 RUSSIA                    |   1996 | 467529186.301127
 RUSSIA                    |   1995 | 468834861.727465
 RUSSIA                    |   1994 | 470071883.036097
 RUSSIA                    |   1993 | 466740823.208303
 RUSSIA                    |   1992 | 480004588.176097
 SAUDI ARABIA              |   1998 | 280080734.123734
 SAUDI ARABIA              |   1997 | 469199982.321719
 SAUDI ARABIA              |   1996 | 460565985.175529
 SAUDI ARABIA              |   1995 | 475047967.944513
 SAUDI ARABIA              |   1994 | 470039673.529905
 SAUDI ARABIA              |   1993 | 467947552.839103
 SAUDI ARABIA              |   1992 | 469736369.837205
 UNITED KINGDOM            |   1998 | 271064715.159418
 UNITED KINGDOM            |   1997 | 464779515.519963
 UNITED KINGDOM            |   1996 | 463903931.060084
 UNITED KINGDOM            |   1995 |  462653062.13018
 UNITED KINGDOM            |   1994 | 459069641.215486
 UNITED KINGDOM            |   1993 | 459007278.895331
 UNITED KINGDOM            |   1992 | 458512716.315606
 UNITED STATES             |   1998 | 279915621.616838
 UNITED STATES             |   1997 | 478219759.806928
 UNITED STATES             |   1996 |  480620692.19376
 UNITED STATES             |   1995 | 480302195.970454
 UNITED STATES             |   1994 | 485827692.059106
 UNITED STATES             |   1993 | 480587288.892099
 UNITED STATES             |   1992 | 480773612.826041
 VIETNAM                   |   1998 | 273976337.381168
 VIETNAM                   |   1997 | 463895302.769972
 VIETNAM                   |   1996 | 459796934.444015
 VIETNAM                   |   1995 | 464795221.494744
 VIETNAM                   |   1994 |  457202599.22296
 VIETNAM                   |   1993 | 465269789.422185
 VIETNAM                   |   1992 | 467749754.898369
(175 rows)

COMMIT;
COMMIT
