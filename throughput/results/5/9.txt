BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%linen%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 257966007.182771
 ALGERIA                   |   1997 | 447935162.088072
 ALGERIA                   |   1996 | 456558683.772982
 ALGERIA                   |   1995 | 455861915.482048
 ALGERIA                   |   1994 | 446786009.907232
 ALGERIA                   |   1993 | 453660264.123475
 ALGERIA                   |   1992 | 449856672.409767
 ARGENTINA                 |   1998 | 275497698.285091
 ARGENTINA                 |   1997 |  471736719.48909
 ARGENTINA                 |   1996 | 469869086.763572
 ARGENTINA                 |   1995 | 474120371.522438
 ARGENTINA                 |   1994 | 464407919.824474
 ARGENTINA                 |   1993 | 474246479.050202
 ARGENTINA                 |   1992 | 478555993.505489
 BRAZIL                    |   1998 | 277787730.061668
 BRAZIL                    |   1997 | 470282652.003021
 BRAZIL                    |   1996 | 461666164.392913
 BRAZIL                    |   1995 | 463123375.015566
 BRAZIL                    |   1994 | 464126832.361455
 BRAZIL                    |   1993 | 461409179.885615
 BRAZIL                    |   1992 | 467285643.314894
 CANADA                    |   1998 | 272294180.002995
 CANADA                    |   1997 | 476811805.805503
 CANADA                    |   1996 |  475352193.20917
 CANADA                    |   1995 | 472168076.122649
 CANADA                    |   1994 | 472903835.499752
 CANADA                    |   1993 | 474564976.695994
 CANADA                    |   1992 | 470893284.125527
 CHINA                     |   1998 | 272249486.958338
 CHINA                     |   1997 | 465502463.454334
 CHINA                     |   1996 |  463925520.52244
 CHINA                     |   1995 | 461249203.825952
 CHINA                     |   1994 | 463581930.136303
 CHINA                     |   1993 | 465275202.089223
 CHINA                     |   1992 | 471002472.508084
 EGYPT                     |   1998 | 271135435.531688
 EGYPT                     |   1997 | 458214122.773121
 EGYPT                     |   1996 | 470837931.362757
 EGYPT                     |   1995 | 463257567.129703
 EGYPT                     |   1994 | 462841590.872343
 EGYPT                     |   1993 | 459571177.394443
 EGYPT                     |   1992 |   469098126.7669
 ETHIOPIA                  |   1998 | 264650696.780387
 ETHIOPIA                  |   1997 | 451048336.786754
 ETHIOPIA                  |   1996 | 441423213.751052
 ETHIOPIA                  |   1995 | 452333342.368917
 ETHIOPIA                  |   1994 | 456348695.101339
 ETHIOPIA                  |   1993 | 447321230.994136
 ETHIOPIA                  |   1992 | 457271310.181765
 FRANCE                    |   1998 | 263468565.721963
 FRANCE                    |   1997 | 453250095.911683
 FRANCE                    |   1996 | 447405606.146764
 FRANCE                    |   1995 | 445347838.982872
 FRANCE                    |   1994 | 453788342.672487
 FRANCE                    |   1993 | 452785498.275621
 FRANCE                    |   1992 | 459453881.417905
 GERMANY                   |   1998 | 278962994.134639
 GERMANY                   |   1997 | 469953582.489602
 GERMANY                   |   1996 | 474455248.311037
 GERMANY                   |   1995 | 471649367.820505
 GERMANY                   |   1994 | 479171398.601738
 GERMANY                   |   1993 | 477461686.513523
 GERMANY                   |   1992 | 470257948.113263
 INDIA                     |   1998 | 279711589.830253
 INDIA                     |   1997 | 474902039.443231
 INDIA                     |   1996 | 476114150.435843
 INDIA                     |   1995 | 472138051.500044
 INDIA                     |   1994 | 479364262.544051
 INDIA                     |   1993 | 477046779.865244
 INDIA                     |   1992 | 482152896.977435
 INDONESIA                 |   1998 | 273973651.973279
 INDONESIA                 |   1997 | 462823320.117976
 INDONESIA                 |   1996 |  464065648.44146
 INDONESIA                 |   1995 | 460096182.281024
 INDONESIA                 |   1994 | 461897603.676155
 INDONESIA                 |   1993 |  457899656.60811
 INDONESIA                 |   1992 | 457160571.276686
 IRAN                      |   1998 | 273398903.451449
 IRAN                      |   1997 | 459287214.657573
 IRAN                      |   1996 | 469338308.040446
 IRAN                      |   1995 | 473399004.268926
 IRAN                      |   1994 | 468893528.613417
 IRAN                      |   1993 | 467291187.397746
 IRAN                      |   1992 | 468488414.246064
 IRAQ                      |   1998 | 276836344.822155
 IRAQ                      |   1997 | 473908556.333515
 IRAQ                      |   1996 | 476239473.214836
 IRAQ                      |   1995 | 477818589.375416
 IRAQ                      |   1994 | 474528045.784467
 IRAQ                      |   1993 |   477712359.4946
 IRAQ                      |   1992 | 468092161.196538
 JAPAN                     |   1998 | 269039458.480297
 JAPAN                     |   1997 | 464884945.096866
 JAPAN                     |   1996 | 459855213.923135
 JAPAN                     |   1995 |  455776985.51318
 JAPAN                     |   1994 | 464236850.346998
 JAPAN                     |   1993 | 458296690.064356
 JAPAN                     |   1992 | 454467418.799792
 JORDAN                    |   1998 | 273428355.010313
 JORDAN                    |   1997 | 459122148.312773
 JORDAN                    |   1996 | 460770347.153444
 JORDAN                    |   1995 | 462976027.039044
 JORDAN                    |   1994 | 460887300.752274
 JORDAN                    |   1993 | 462532799.994433
 JORDAN                    |   1992 | 464754027.070778
 KENYA                     |   1998 | 267480875.931101
 KENYA                     |   1997 | 463429374.366964
 KENYA                     |   1996 | 472920657.260157
 KENYA                     |   1995 | 466509437.723824
 KENYA                     |   1994 | 470102173.361461
 KENYA                     |   1993 | 464697435.000228
 KENYA                     |   1992 | 461798471.181841
 MOROCCO                   |   1998 | 270366500.402759
 MOROCCO                   |   1997 | 458541453.818234
 MOROCCO                   |   1996 | 470384963.710927
 MOROCCO                   |   1995 | 454154721.926651
 MOROCCO                   |   1994 |  456128597.46734
 MOROCCO                   |   1993 | 458852463.401553
 MOROCCO                   |   1992 | 471987328.595717
 MOZAMBIQUE                |   1998 | 272965420.366368
 MOZAMBIQUE                |   1997 |   465058291.7147
 MOZAMBIQUE                |   1996 | 463925539.923612
 MOZAMBIQUE                |   1995 | 464997132.275356
 MOZAMBIQUE                |   1994 |  460325793.47307
 MOZAMBIQUE                |   1993 | 467449399.829669
 MOZAMBIQUE                |   1992 | 458118789.600498
 PERU                      |   1998 | 268774728.670692
 PERU                      |   1997 | 468176143.145732
 PERU                      |   1996 | 464246393.898598
 PERU                      |   1995 | 472386639.010071
 PERU                      |   1994 | 468133241.320077
 PERU                      |   1993 | 464165463.226474
 PERU                      |   1992 | 478380585.855899
 ROMANIA                   |   1998 | 275763824.176172
 ROMANIA                   |   1997 | 462046454.330206
 ROMANIA                   |   1996 | 476753588.743731
 ROMANIA                   |   1995 | 469467771.168636
 ROMANIA                   |   1994 | 473655709.219337
 ROMANIA                   |   1993 | 465614102.293371
 ROMANIA                   |   1992 | 466708402.498885
 RUSSIA                    |   1998 |  270958187.34843
 RUSSIA                    |   1997 | 467565801.717307
 RUSSIA                    |   1996 | 464754346.093757
 RUSSIA                    |   1995 | 464865453.611144
 RUSSIA                    |   1994 | 457161456.970192
 RUSSIA                    |   1993 | 460700229.686065
 RUSSIA                    |   1992 | 468489206.249854
 SAUDI ARABIA              |   1998 | 273207740.318307
 SAUDI ARABIA              |   1997 | 463227665.560849
 SAUDI ARABIA              |   1996 | 473048147.365659
 SAUDI ARABIA              |   1995 | 471069375.797831
 SAUDI ARABIA              |   1994 | 460838133.292876
 SAUDI ARABIA              |   1993 | 469138785.291404
 SAUDI ARABIA              |   1992 | 464416668.530185
 UNITED KINGDOM            |   1998 | 273771868.835206
 UNITED KINGDOM            |   1997 | 472143286.673416
 UNITED KINGDOM            |   1996 | 466687386.353522
 UNITED KINGDOM            |   1995 | 466281973.465888
 UNITED KINGDOM            |   1994 | 463367165.798938
 UNITED KINGDOM            |   1993 | 456050511.242785
 UNITED KINGDOM            |   1992 |  461812789.85264
 UNITED STATES             |   1998 | 278942360.706869
 UNITED STATES             |   1997 | 467378793.255784
 UNITED STATES             |   1996 | 471498366.030497
 UNITED STATES             |   1995 | 474699359.922834
 UNITED STATES             |   1994 | 480775484.169682
 UNITED STATES             |   1993 |   470302130.5873
 UNITED STATES             |   1992 | 474073000.399927
 VIETNAM                   |   1998 | 274801919.028128
 VIETNAM                   |   1997 | 463676176.118422
 VIETNAM                   |   1996 | 473873928.353494
 VIETNAM                   |   1995 | 463459176.593292
 VIETNAM                   |   1994 | 469222992.010794
 VIETNAM                   |   1993 | 469916277.076548
 VIETNAM                   |   1992 | 469786456.275441
(175 rows)

COMMIT;
COMMIT
